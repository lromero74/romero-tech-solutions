
> romero-tech-backend@1.0.0 dev
> nodemon server.js

[33m[nodemon] 3.1.10[39m
[33m[nodemon] to restart at any time, enter `rs`[39m
[33m[nodemon] watching path(s): *.*[39m
[33m[nodemon] watching extensions: js,mjs,cjs,json[39m
[32m[nodemon] starting `node server.js`[39m
üìß Email service initialization: {
  hasAwsKeyId: true,
  hasAwsSecret: true,
  hasSesSmtpUser: true,
  hasSesSmtpPass: true,
  awsRegion: 'us-east-1',
  sesHost: 'email-smtp.us-east-1.amazonaws.com'
}
üîç Testing database connection...
üîê Using AWS Secrets Manager for database credentials
üîê Fetching secret from AWS: rds!cluster-9e81a628-84ff-470b-be3c-30cbeb7a3b98
‚úÖ Successfully retrieved secret: rds!cluster-9e81a628-84ff-470b-be3c-30cbeb7a3b98
‚úÖ Database connected successfully
Current time: Fri Sep 26 2025 20:37:48 GMT-0700 (Pacific Daylight Time)
‚úÖ WebSocket service initialized
üöÄ Server running on port 3001
üìä Health check: http://localhost:3001/health
üóÑÔ∏è  Database health: http://localhost:3001/health/db
üåê Environment: development
üîí CORS origins: http://localhost:5173,http://localhost:5174,https://romerotechsolutions.com,https://*.amplifyapp.com
üîå WebSocket service: ENABLED
üßπ Starting automated session cleanup...
Executed query in 122ms: 
        SELECT cleanup_expired_sessions() as cleaned_count
      
üßπ Initial cleanup: 0 expired sessions removed
‚úÖ Session cleanup scheduled every 15 minutes
Executed query in 106ms: 
      SELECT COUNT(DISTINCT e.id) as admin_count
      FROM employees e
      JOIN employee_roles er ON e.id = er.employee_id
      JOIN roles r ON er.role_id = r.id
      WHERE r.name = $1 AND r.is_active = true
    
::1 - - [27/Sep/2025:03:37:52 +0000] "GET /api/auth/check-admin HTTP/1.1" 304 - "http://localhost:5173/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Executed query in 110ms: 
      SELECT COUNT(DISTINCT e.id) as admin_count
      FROM employees e
      JOIN employee_roles er ON e.id = er.employee_id
      JOIN roles r ON er.role_id = r.id
      WHERE r.name = $1 AND r.is_active = true
    
::1 - - [27/Sep/2025:03:37:52 +0000] "GET /api/auth/check-admin HTTP/1.1" 304 - "http://localhost:5173/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Executed query in 218ms: 
        SELECT cleanup_expired_sessions() as cleaned_count
      
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node server.js`[39m
üìß Email service initialization: {
  hasAwsKeyId: true,
  hasAwsSecret: true,
  hasSesSmtpUser: true,
  hasSesSmtpPass: true,
  awsRegion: 'us-east-1',
  sesHost: 'email-smtp.us-east-1.amazonaws.com'
}
üîç Testing database connection...
üîê Using AWS Secrets Manager for database credentials
üîê Fetching secret from AWS: rds!cluster-9e81a628-84ff-470b-be3c-30cbeb7a3b98
‚úÖ Successfully retrieved secret: rds!cluster-9e81a628-84ff-470b-be3c-30cbeb7a3b98
‚úÖ Database connected successfully
Current time: Fri Sep 26 2025 21:05:21 GMT-0700 (Pacific Daylight Time)
‚úÖ WebSocket service initialized
üöÄ Server running on port 3001
üìä Health check: http://localhost:3001/health
üóÑÔ∏è  Database health: http://localhost:3001/health/db
üåê Environment: development
üîí CORS origins: http://localhost:5173,http://localhost:5174,https://romerotechsolutions.com,https://*.amplifyapp.com
üîå WebSocket service: ENABLED
üßπ Starting automated session cleanup...
Executed query in 125ms: 
        SELECT cleanup_expired_sessions() as cleaned_count
      
üßπ Initial cleanup: 0 expired sessions removed
‚úÖ Session cleanup scheduled every 15 minutes
Executed query in 112ms: 
      SELECT COUNT(DISTINCT e.id) as admin_count
      FROM employees e
      JOIN employee_roles er ON e.id = er.employee_id
      JOIN roles r ON er.role_id = r.id
      WHERE r.name = $1 AND r.is_active = true
    
::1 - - [27/Sep/2025:04:06:33 +0000] "GET /api/auth/check-admin HTTP/1.1" 304 - "http://localhost:5173/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Executed query in 100ms: 
      SELECT COUNT(DISTINCT e.id) as admin_count
      FROM employees e
      JOIN employee_roles er ON e.id = er.employee_id
      JOIN roles r ON er.role_id = r.id
      WHERE r.name = $1 AND r.is_active = true
    
::1 - - [27/Sep/2025:04:06:33 +0000] "GET /api/auth/check-admin HTTP/1.1" 304 - "http://localhost:5173/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Executed query in 105ms: 
      SELECT COUNT(DISTINCT e.id) as admin_count
      FROM employees e
      JOIN employee_roles er ON e.id = er.employee_id
      JOIN roles r ON er.role_id = r.id
      WHERE r.name = $1 AND r.is_active = true
    
::1 - - [27/Sep/2025:04:06:42 +0000] "GET /api/auth/check-admin HTTP/1.1" 304 - "http://localhost:5173/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Executed query in 101ms: 
      SELECT COUNT(DISTINCT e.id) as admin_count
      FROM employees e
      JOIN employee_roles er ON e.id = er.employee_id
      JOIN roles r ON er.role_id = r.id
      WHERE r.name = $1 AND r.is_active = true
    
::1 - - [27/Sep/2025:04:06:42 +0000] "GET /api/auth/check-admin HTTP/1.1" 304 - "http://localhost:5173/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
